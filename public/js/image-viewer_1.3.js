YUI.add("image-viewer",function(d){var c=d.Lang,b="contentBox",e="boundingBox";var a=function(){a.superclass.constructor.apply(this,arguments)};a.NAME="imageViewer";a.NS="iv";a.ATTRS={shots:{value:[],setter:function(f){return c.isArray(f)?f:[]}},sizeRange:{value:{maxHeight:600,minHeight:300,maxWidth:600,minWidth:300,defaultHeight:480,defaultWidth:480},initOnly:true},visible:false,selectedIndex:{value:0,setter:function(f){f=parseInt(f);return f?f:0}}};d.ImageViewer=d.extend(a,d.Widget,{tpl_container:'<div id="img-overlay"><div style="width:600px; text-align:right; margin:0 auto"><span class="img_overlay_close"><span id="img_overlay_close"></span></span></div><div id="img-overlay-center" style="position:relative;overflow: hidden;width: 100%; height:480px;"><div class="showImg_prev"><a href="javascript:void(0);" target="_self" hidefocus="true" class="showImg_btn_prev" id="showImg_Prev"></a></div><div class="showImg_next"><a href="javascript:void(0);" target="_self" hidefocus="true" class="showImg_btn_next" id="showImg_Next"></a></div><div id="loadingGif" class="view-loading"></div><table cellpadding="0" cellspacing="0"><tbody><tr><td><img id="shown-img"/></td></tr></tbody></table></div><div class="showImg_sel m-t20"><ul id="img-icon-list"></ul></div></div>',tpl_trigger:'<li class="img_icon_normal"><span>&nbsp;</span></li>',initializer:function(){if(d.UA.ie&&d.UA.ie<7){this.ISIE6=true}},renderUI:function(){this._createViewer()},bindUI:function(){this._bindEvent()},showImage:function(f){this._fixPosition();this._showViewer();this.set("selectedIndex",f?f:0)},_createViewer:function(){var g=this.get(b),f=this.get(e);f.setStyles({position:"absolute",zIndex:9999});g.appendChild(this.tpl_container)},_bindEvent:function(){var g=this;this.on("selectedIndexChange",function(h){g._selectTrigger(h.newVal)});this.after("shotsChange",g._updateTrigger);d.on("click",g._onClickArrow,["#showImg_Prev","#showImg_Next"],g);d.one("#img_overlay_close").on("click",g._hideViewer,g);var f=d.one("#img-icon-list");f.delegate("mouseenter",function(h){g.set("selectedIndex",f.all("li").indexOf(h.currentTarget))},"li")},_fixPosition:function(){var g=this.get(e),f=d.one("document").get("scrollTop");g.setStyles({left:0,top:f+20})},_selectTrigger:function(g){var f=d.all("#img-icon-list li");f.item(g).replaceClass("img_icon_normal","img_icon_active").siblings().replaceClass("img_icon_active","img_icon_normal");this._showImageByIndex(g);this._toggleArrow(g)},_showImageByIndex:function(g){var k=(this.get("shots"))[g].ImgUrl,h=d.Node.create("<img>").getDOMNode(),f=d.one("#loadingGif");f.show();h.src=k;if(h.complete){this._switchImage(k,h.width,h.height);f.hide()}else{var j=this;h.onload=function(){j._switchImage(k,h.width,h.height);f.hide()}}},_switchImage:function(m,f,i){var g=this.get("sizeRange.defaultWidth"),k=this.get("sizeRange.defaultHeight"),j=d.one("#shown-img").getDOMNode();if(this.ISIE6){if(f>g||i>k){var l=this.imgRegionForIE6(i,f,k,g);j.width=l.width;j.height=l.height}}j.src=m},_toggleArrow:function(g){var f=this.get("shots").length,j=d.one("#showImg_Prev"),h=d.one("#showImg_Next");if(1==f){j.hide();h.hide()}else{if(g==0){j.hide();h.show()}else{if(g==f-1){j.show();h.hide()}else{j.show();h.show()}}}},_onClickArrow:function(h){var g=this.get("selectedIndex"),f=this.get("shots").length,i=h.currentTarget.get("id");h.preventDefault();if(i=="showImg_Prev"){if(g>0){this.set("selectedIndex",--g)}}else{if(g<f-1){this.set("selectedIndex",++g)}}},_updateTrigger:function(){var j=this.get(b).one("#img-icon-list"),h=this.get("shots"),f="";for(var g=0;g<h.length;++g){f+=this.tpl_trigger}j.empty().appendChild(f)},_showViewer:function(){window.mask.show();this.show()},_hideViewer:function(){this.hide();window.mask.hide()},imgRegionForIE6:function(i,f,g,k){var j={};if(k/f<=g/i){if(k<f){j.width=k;j.height=k/f*i}}else{if(g<i){j.width=g/i*f;j.height=g}}return j}})},"3.4.0",{skinnable:false,requires:["node","widget","event-delegate","event-mouseenter"]});
